@namespace AXSharp.Presentation.Blazor.Controls.Dialogs.AlertDialog
@using AXSharp.Abstractions.Dialogs.AlertDialog;
@if (_dialogService.GetToasts() != null && _dialogService.GetToasts().Count > 0)
{
    <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 100;">
        @foreach (Toast toast in _dialogService.GetToasts())
        {
            var bg = "";
            var icon = "";
            switch (toast.Type)
            {
                case "Info":
                    bg = "bg-primary text-white";
                    icon = "oi oi-info";
                    break;
                case "Success":
                    bg = "bg-success text-white";
                    icon = "oi oi-circle-check";
                    break;
                case "Danger":
                    bg = "bg-danger text-white";
                    icon = "oi oi-circle-x";
                    break;
                case "Warning":
                    bg = "bg-warning text-dark";
                    icon = "oi oi-warning";
                    break;
            }

            <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header @bg">
                    <span class="@icon me-2" aria-hidden="true"></span>
                    <strong class="me-auto">@toast.Title</strong>
                    <small>@GetTime(toast.Posted)</small>
                    @if (_dialogService.GetToasts().Count > 2)
                    {
                        <div class="dropup">
                            <button type="button" class="btn-close" data-bs-toggle="dropdown" aria-expanded="false"></button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" @onclick="() => _dialogService.RemoveAllToast()">Close all</a></li>
                                <li><a class="dropdown-item" @onclick="() => _dialogService.RemoveToast(toast)">Close</a></li>
                            </ul>
                        </div>
                    }
                    else
                    {
                        <button type="button" class="btn-close" @onclick="() => _dialogService.RemoveToast(toast)"></button>
                    }
                </div>
                <div class="toast-body">
                    @toast.Message
                </div>
            </div>
        }
    </div>
}

@code {
    [Inject]
    private IDialogService _dialogService { get; set; }

    private string GetTime(DateTimeOffset time)
    {
        var calcTime = -(time - DateTimeOffset.Now);
        if (calcTime.TotalSeconds < 5)
        {
            return "just now";
        }
        else if (calcTime.TotalSeconds < 60)
        {
            return $"{Math.Round(calcTime.TotalSeconds)} secs ago";
        }
        else
        {
            return $"{Math.Round(calcTime.TotalMinutes)} mins ago";
        }
    }
}